"use strict";function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Component=function Component(){_classCallCheck(this,Component),this.name=this.constructor.name},Position=function(_Component){function Position(x,y){_classCallCheck(this,Position);var _this=_possibleConstructorReturn(this,(Position.__proto__||Object.getPrototypeOf(Position)).call(this));return _this.x=x,_this.y=y,_this}return _inherits(Position,_Component),Position}(Component),Velocity=function(_Component2){function Velocity(x,y){_classCallCheck(this,Velocity);var _this2=_possibleConstructorReturn(this,(Velocity.__proto__||Object.getPrototypeOf(Velocity)).call(this));return _this2.x=x,_this2.y=y,_this2}return _inherits(Velocity,_Component2),Velocity}(Component),Sprite=function(_Component3){function Sprite(spriteSource){_classCallCheck(this,Sprite);var _this3=_possibleConstructorReturn(this,(Sprite.__proto__||Object.getPrototypeOf(Sprite)).call(this));return _this3.spriteSource=spriteSource,_this3}return _inherits(Sprite,_Component3),Sprite}(Component),AnimatedSprite=function(_Component4){function AnimatedSprite(spriteSource,animationSheet){_classCallCheck(this,AnimatedSprite);var _this4=_possibleConstructorReturn(this,(AnimatedSprite.__proto__||Object.getPrototypeOf(AnimatedSprite)).call(this));return _this4.spriteSource=spriteSource,_this4.animationSheet=animationSheet,_this4}return _inherits(AnimatedSprite,_Component4),AnimatedSprite}(Component),Box=function(_Component5){function Box(width,height,fillStyle){_classCallCheck(this,Box);var _this5=_possibleConstructorReturn(this,(Box.__proto__||Object.getPrototypeOf(Box)).call(this));return _this5.width=width,_this5.height=height,_this5.fillStyle=fillStyle,_this5}return _inherits(Box,_Component5),Box}(Component),BoxCollider=function(_Component6){function BoxCollider(width,height){_classCallCheck(this,BoxCollider);var _this6=_possibleConstructorReturn(this,(BoxCollider.__proto__||Object.getPrototypeOf(BoxCollider)).call(this));return _this6.width=width,_this6.height=height,_this6}return _inherits(BoxCollider,_Component6),BoxCollider}(Component),DirectionalInput=function(_Component7){function DirectionalInput(){_classCallCheck(this,DirectionalInput);var _this7=_possibleConstructorReturn(this,(DirectionalInput.__proto__||Object.getPrototypeOf(DirectionalInput)).call(this));return _this7.up=!1,_this7.down=!1,_this7.left=!1,_this7.right=!1,_this7}return _inherits(DirectionalInput,_Component7),DirectionalInput}(Component),Entity=function(){function Entity(){_classCallCheck(this,Entity),this.id=Entity.prototype.count,Entity.prototype.count++}return _createClass(Entity,[{key:"addComponent",value:function(component){this[component.name]=component}},{key:"removeComponent",value:function(componentName){delete this[componentName]}},{key:"hasComponent",value:function(componentName){return null!=this[componentName]}},{key:"hasComponents",value:function(componentArray){for(var len=componentArray.length,i=0;i<len;i++)if(!this.hasComponent(componentArray[i]))return!1;return!0}}]),Entity}();Entity.prototype.count=0;var Game=function(){function Game(canvasContext){function startSystem(){if(window.requestAnimationFrame(startSystem),now=Date.now(),(delta=now-then)>interval){if(then=now-delta%interval,!that.currentScene)return;for(var e in that.currentScene.gameEntities)for(var s in that.currentScene.systems){var entity=that.currentScene.gameEntities[e],system=that.currentScene.systems[s];entity.hasComponents(system.requiredComponents)&&that.currentScene.systems[s].update.call(that,entity)}that.canvasContext.fillStyle="white",that.canvasContext.fillRect(0,0,that.canvasContext.canvas.width,that.canvasContext.canvas.height);var cur;for(var e in that.currentScene.gameEntities)cur=that.currentScene.gameEntities[e],cur.hasComponent("Box")&&cur.hasComponent("Position")&&(that.canvasContext.fillStyle=cur.Box.fillStyle,that.canvasContext.fillRect(cur.Position.x,cur.Position.y,cur.Box.width,cur.Box.height)),cur.hasComponent("Sprite")&&cur.hasComponent("Position")&&that.canvasContext.drawImage(cur.Sprite.spriteSource,cur.Position.x,cur.Position.y),that.getDebugMode()&&(ctx.fillStyle="rgba(0, 0, 0, 1)",ctx.fillText(that.inputService.pressedKeys,40,60))}}_classCallCheck(this,Game);var that=this;this.canvasContext=canvasContext,canvasContext.webkitImageSmoothingEnabled=!1,canvasContext.imageSmoothingEnabled=!1;try{this.audioContext,new(window.AudioContext||window.webkitAudioContext)}catch(e){console.log("WebAudio API is not supported by this browser")}this.inputService=new InputService,this.step=null,this.onKeyPress=null,this.songsPlaying=[],this.gameScenes={},this.currentScene=null,this.sceneEntities={},this.sceneSystems={},this.fps=60,this.startRendering=function(fps){that.fps=60|fps,startSystem()};var now,delta,interval=1e3/this.fps,then=Date.now();console.log("Game object created")}return _createClass(Game,[{key:"addScene",value:function(scene){this.gameScenes[scene.sceneId]=scene,null==this.currentScene&&this.switchToScene(scene.sceneId)}},{key:"switchToScene",value:function(sceneId){null!=this.gameScenes[sceneId]?(this.currentScene=this.gameScenes[sceneId],this.currentScene.initialized&&!this.currentScene.alwaysInitialize||this.currentScene.initCallback()):this.log("Scene doesn't exist: "+sceneId)}},{key:"setDebugMode",value:function(isDebug){Game.prototype.debugMode=isDebug}},{key:"getDebugMode",value:function(){return Game.prototype.debugMode}},{key:"log",value:function(message){Game.prototype.debugMode&&console.log(message)}}]),Game}();Game.prototype.debugMode=!1;var InputService=function(){function InputService(){_classCallCheck(this,InputService);var that=this;this.pressedKeys=[],window.addEventListener("keydown",function(e){-1===that.pressedKeys.indexOf(e.keyCode)&&that.pressedKeys.push(e.keyCode)},!1),window.addEventListener("keyup",function(e){that.pressedKeys.splice(that.pressedKeys.indexOf(e.keyCode),1)},!1)}return _createClass(InputService,[{key:"isPressed",value:function(key){return-1!==this.pressedKeys.indexOf(key)}}]),InputService}(),SystemScope={LOCAL:"local",GLOBAL:"global"},SystemType={RENDER:"render",NONRENDER:"nonrender"},Scene=function(){function Scene(options){_classCallCheck(this,Scene),this.sceneId=options.sceneId||"defaultScene",this.initialized=!1,this.initCallback=options.init||function(){},this.alwaysInitialize=options.alwaysInitialize||!0,this.systemScope=options.scope||SystemScope.LOCAL,this.systemType=options.type||SystemType.NONRENDER,this.gameEntities={},this.systems={}}return _createClass(Scene,[{key:"registerSystem",value:function(system){this.systems[system.systemId]=system}},{key:"unregisterSystem",value:function(system){delete this.systems[system.systemId]}},{key:"addEntity",value:function(entity){this.gameEntities[entity.id]=entity}}]),Scene}(),DirectionalInputSystem={systemId:"directionalInput",requiredComponents:["DirectionalInput"],update:function(entity){entity.DirectionalInput.up=this.inputService.isPressed(38),entity.DirectionalInput.down=this.inputService.isPressed(40),entity.DirectionalInput.left=this.inputService.isPressed(37),entity.DirectionalInput.right=this.inputService.isPressed(39)}};